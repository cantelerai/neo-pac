let gameStarted = false;
let pacman = document.getElementById("pacman");
let ghost = document.getElementById("ghost");
let music = document.getElementById("background-music");
let deathSound = document.getElementById("death-sound");
let isSoundOn = true;
let timer;
let timeLeft;
let level = "easy";
let playerPos = 0;
let ghostPos = 63;
let cells = [];
let playerLives = 1;

const ctx = document.getElementById("gameCanvas").getContext("2d");

const pacmanImage = new Image();
pacmanImage.src = 'assets/pacman.png';  // Imagem do Pac-Man

const ghostImage = new Image();
ghostImage.src = 'assets/ghost.png';  // Imagem do fantasma

function toggleSound() {
  isSoundOn = !isSoundOn;
  if (isSoundOn) {
    music.play();
    document.getElementById("sound-button").innerText = "ðŸ”Š Som";
  } else {
    music.pause();
    document.getElementById("sound-button").innerText = "ðŸ”‡ Som";
  }
}

function startGame() {
  document.getElementById("start-screen").style.display = "none";
  document.getElementById("game-container").style.display = "block";

  level = document.getElementById("difficulty").value;
  if (level === "easy") timeLeft = 60;
  else if (level === "medium") timeLeft = 40;
  else timeLeft = 25;

  document.getElementById("timer").innerText = `Tempo: ${timeLeft}s`;
  startTimer();
  generateMap();
  gameStarted = true;

  if (isSoundOn) music.play();
  document.addEventListener("keydown", movePlayer);
}

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").innerText = `Tempo: ${timeLeft}s`;
    if (timeLeft <= 0) {
      clearInterval(timer);
      if (isSoundOn) deathSound.play();
      alert("Tempo esgotado! Fim de jogo!");
      location.reload();
    }
  }, 1000);
}

function generateMap() {
  cells = [];
  for (let i = 0; i < 64; i++) {
    const cell = document.createElement("div");
    cell.classList.add("cell");
    if (Math.random() < 0.1) cell.classList.add("super-dot");
    else cell.classList.add("food");
    cells.push(cell);
  }
  updatePlayer();
  updateGhost();
}

function drawCharacters() {
  updatePlayer();
  updateGhost();
}

function updatePlayer() {
  ctx.clearRect(0, 0, 400, 400);  // Limpa o canvas a cada atualizaÃ§Ã£o
  
  // Desenha o Pac-Man usando a imagem carregada
  ctx.drawImage(pacmanImage, 50, 50, 40, 40); // (x, y, largura, altura)
}

function updateGhost() {
  // Desenha o Fantasma usando a imagem carregada
  ctx.drawImage(ghostImage, 350, 350, 40, 40); // (x, y, largura, altura)
}

function movePlayer(e) {
  if (!gameStarted) return;
  let newPos = playerPos;

  if (e.key === "ArrowRight") playerPos++;
  if (e.key === "ArrowLeft") playerPos--;
  if (e.key === "ArrowUp") playerPos -= 8;
  if (e.key === "ArrowDown") playerPos += 8;

  updatePlayer();
}
